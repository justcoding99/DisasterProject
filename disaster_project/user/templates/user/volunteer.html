
{% extends "user/base.html" %}
{% load custom_tags %}
{% load crispy_forms_tags %}

<head>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">



{% block title %}
    <title>Disaster Recovery Website Hompage</title>
{% endblock %}

</head>

{% block content %}
<style>
.jumbotron.jumbotron-fluid{
    text-align: center;
    background: none;
}
.lead{
    font-weight: 350;
    display: inline-grid;
    padding: 25px 30px 25px 30px;
}
.submitform{
    margin: auto;
    display: block;
    padding: 10px;
}
.btnclass {
<!--  height: 200px;-->
<!--  width: 200px;-->
  background-color: yellowgreen;
  position: relative;
}

.alist:hover .groupbtn {
  display: block;
}
.groupbtn {
  display: none;
  position: absolute;
  top: 5px;
  right: 5px;

 }

table {
  border-collapse: collapse;
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  font-size: 14px;
  text-align: center;
}

th {
  background-color: #abd4c6;
  border: 1px solid #ddd;
  padding: 8px;
  text-transform: uppercase;
}

td {
  border: 1px solid #ddd;
  padding: 8px;
}
}

.hidden {
    display: none;
}

    </style>

<!--<div class="container">-->
<!--  <div class="row">-->
<!--    <div class="col-md-12">-->
<!--        <p class="lead 1" style="text-align:left">Help List</p>-->

<!--&lt;!&ndash;        <table>&ndash;&gt;-->
<!--&lt;!&ndash;    <tr>&ndash;&gt;-->
<!--&lt;!&ndash;      <th>ID</th>&ndash;&gt;-->
<!--&lt;!&ndash;      <th>First Name</th>&ndash;&gt;-->
<!--&lt;!&ndash;      <th>Last Name</th>&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;      <th>Phone</th>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;      <th>Address</th>&ndash;&gt;-->
<!--&lt;!&ndash;      <th>Help Class</th>&ndash;&gt;-->
<!--&lt;!&ndash;      <th>Quantity</th>&ndash;&gt;-->
<!--&lt;!&ndash;      <th>Created At</th>&ndash;&gt;-->
<!--&lt;!&ndash;      <th>Action</th>&ndash;&gt;-->
<!--&lt;!&ndash;    </tr>&ndash;&gt;-->
<!--&lt;!&ndash;    {% for need in needs %}&ndash;&gt;-->
<!--&lt;!&ndash;      <tr id="hiderow">&ndash;&gt;-->
<!--&lt;!&ndash;        <td>{{ need.id }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;        <td>{{ need.first_name }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;        <td>{{ need.last_name }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;        <td>{{ need.phone }}</td>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;        <td>{{ need.address }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;        <td>{{ need.help_class }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;        <td>{{ need.quantity }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;        <td>{{ need.created_at | prettydate }}</td>&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;        <td> <button onclick="displayQuantityForm()">Help 1 </button>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;            <div id="formContainer"></div>&ndash;&gt;&ndash;&gt;-->

<!--&lt;!&ndash;&lt;!&ndash;        </td>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;        <td>  <a class="btn btn-primary" href="{% url 'user:change_status' pk=need.pk %}" role="button" onclick="hide()">Help</a> </td>&ndash;&gt;-->
<!--&lt;!&ndash;      </tr>&ndash;&gt;-->
<!--&lt;!&ndash;      {% endfor %}&ndash;&gt;-->

<!--&lt;!&ndash;   </table>&ndash;&gt;-->
<!--   {% if needs.has_other_pages %}-->
<!--        <div class="pagination">-->
<!--          <span class="step-links">-->
<!--            {% if needs.has_previous %}-->
<!--              <a href="?page=1">&laquo; first</a>-->
<!--              <a href="?page={{ needs.previous_page_number }}">previous</a>-->
<!--            {% endif %}-->

<!--            <span class="current-page">-->
<!--              Page {{ needs.number }} of {{ needs.paginator.num_pages }}.-->
<!--            </span>-->

<!--            {% if needs.has_next %}-->
<!--              <a href="?page={{ needs.next_page_number }}">next</a>-->
<!--              <a href="?page={{ needs.paginator.num_pages }}">last &raquo;</a>-->
<!--            {% endif %}-->
<!--          </span>-->
<!--        </div>-->
<!--      {% endif %}-->

<!--    </div>-->

<!--  </div>-->
<!--</div>-->

<div class="container">
  <div class="row">
    <div class="col-md-12">
        <p class="lead 1" style="text-align:left">Help List</p>
        <a class="btn btn-primary" style="float: right;" role="button" href="/helped_archive">View Helped Archive</a>

    <table>
    <tr>
      <th>ID</th>
      <th>First Name</th>
      <th>Last Name</th>
<!--      <th>Phone</th>-->
      <th>Address</th>
      <th>Help Class</th>
      <th>Quantity</th>
      <th>Created At</th>
      <th>Action</th>
    </tr>
    {% for need in needs %}
      <tr id="hiderow">
        <td>{{ need.id }}</td>
        <td>{{ need.first_name }}</td>
        <td>{{ need.last_name }}</td>
<!--        <td>{{ need.phone }}</td>-->
        <td>{{ need.address }}</td>
        <td>{{ need.help_class }}</td>
        <td id="quantity_{{ need.id }}">{{ need.quantity }}</td>
        <td>{{ need.created_at | prettydate }}</td>
        <td>
            <button class="btn btn-primary" id="btn_{{ need.id }}" onclick="toggleForm('{{ need.id }}'); event.preventDefault();">Help</button>

        </td>

        <td>
               <form method="POST" class="hidden" action="{% url 'user:update_quantity' pk=need.id %}" id="form_{{ need.id }}" onsubmit="return validateQuantity({{ need.quantity }});">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <label>Quantity:</label>
                    <input type="number" id="id_quantity" name="quantity" min="0" max="{{ need.quantity }}" value="{{ need.quantity }}">
                    <button type="submit" class="btn btn-primary">Update</button>
               </form>
        </td>


<!--    <td>  <a class="btn btn-primary" href="{% url 'user:change_status' pk=need.pk %}" role="button" onclick="hide()">Help</a> </td>-->
      </tr>
      {% endfor %}

   </table>
        {% if needs.has_other_pages %}
        <div class="pagination">
          <span class="step-links">
            {% if needs.has_previous %}
              <a href="?page=1">&laquo; first</a>
              <a href="?page={{ needs.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current-page">
              Page {{ needs.number }} of {{ needs.paginator.num_pages }}.
            </span>

            {% if needs.has_next %}
              <a href="?page={{ needs.next_page_number }}">next</a>
              <a href="?page={{ needs.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
          </span>
        </div>
      {% endif %}


    </div>
  </div>
</div>


<script>
function toggleForm(itemId) {
    var form = document.getElementById("form_" + itemId);
    var quantityElement = document.getElementById("quantity_" + itemId);
    var quantity = parseInt(quantityElement.innerText);
    form.classList.toggle("hidden");

    }

function validateQuantity(maxQuantity) {
    var quantityInput = document.getElementById("id_quantity");
    var enteredQuantity = parseInt(quantityInput.value);

    if (enteredQuantity > maxQuantity) {
        var errorMessage = "Value should be less than " + maxQuantity + ".";
        quantityInput.setCustomValidity(errorMessage);
        quantityInput.reportValidity(); // Display the custom error message
        return false; // Prevent form submission
    }

    // Clear the custom error message
    quantityInput.setCustomValidity("");

    return true;
}
</script>

{% endblock %}
